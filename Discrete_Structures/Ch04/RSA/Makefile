# ======================================================
# ðŸ“˜ RSA Series Makefile â€” Combine All PDFs
# Author: Jeremy Evert
# ======================================================

LATEX=pdflatex
OUTDIR=output
TEXFILES=$(wildcard ch_04_section_06_RSA*.tex)
PDFFILES=$(patsubst %.tex,$(OUTDIR)/%.pdf,$(TEXFILES))
COMBINED=$(OUTDIR)/RSA_Combined.pdf

# ------------------------------------------------------
# Default target
# ------------------------------------------------------
all: $(OUTDIR) $(COMBINED)
	@echo "âœ… All RSA PDFs compiled and combined successfully."

# ------------------------------------------------------
# Rule: build individual PDFs
# ------------------------------------------------------
$(OUTDIR)/%.pdf: %.tex | $(OUTDIR)
	@echo "ðŸ§  Building $< ..."
	@$(LATEX) -interaction=nonstopmode -output-directory=$(OUTDIR) $<
	@$(LATEX) -interaction=nonstopmode -output-directory=$(OUTDIR) $<
	@echo "ðŸ“„ Generated: $@"

# ------------------------------------------------------
# Rule: combine all PDFs into one
# ------------------------------------------------------
$(COMBINED): $(PDFFILES)
	@echo "ðŸª„ Combining PDFs into one master document..."
	@pdfunite $(PDFFILES) $(COMBINED)
	@echo "ðŸŽ‰ Created: $(COMBINED)"

# ------------------------------------------------------
# Ensure output directory exists
# ------------------------------------------------------
$(OUTDIR):
	@mkdir -p $(OUTDIR)

# ------------------------------------------------------
# Cleaning targets
# ------------------------------------------------------
clean:
	@echo "ðŸ§¹ Cleaning auxiliary files..."
	@rm -f $(OUTDIR)/*.aux $(OUTDIR)/*.log $(OUTDIR)/*.out $(OUTDIR)/*.toc
	@echo "âœ… Auxiliary files removed."

distclean: clean
	@echo "ðŸ—‘ï¸ Removing generated PDFs..."
	@rm -f $(OUTDIR)/*.pdf
	@echo "âœ¨ Directory reset."

# ------------------------------------------------------
# Rebuild everything from scratch
# ------------------------------------------------------
rebuild: distclean all

.PHONY: all clean distclean rebuild

